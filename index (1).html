<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Apple Music</title>
    <style>
        /* --- RESET & FONTS --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: white;
            height: 100vh;
            overflow: hidden;
            background-color: #000;
            display: flex;
            flex-direction: column;
        }

        /* --- BACKGROUND DINÂMICO --- */
        .dynamic-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(60px) brightness(0.6) saturate(1.8);
            z-index: -1;
            transition: background-image 1s ease;
            opacity: 0.8;
        }

        /* --- TELA DE BLOQUEIO (Touch to Start) --- */
        #lock-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            cursor: pointer;
        }
        .apple-logo { width: 80px; height: 80px; fill: white; margin-bottom: 20px; }
        .tap-text { color: #888; font-size: 14px; letter-spacing: 1px; text-transform: uppercase; }

        /* --- UI PRINCIPAL --- */
        .player-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end; /* Elementos embaixo */
            padding: 0 30px 50px 30px; /* Margens laterais e inferior */
            max-width: 500px;
            margin: 0 auto;
            width: 100%;
        }

        /* Handle (topo) */
        .grab-handle {
            width: 36px; height: 5px;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
            align-self: center;
            position: absolute; top: 15px;
        }

        /* Capa do Álbum */
        .album-art-container {
            width: 100%;
            aspect-ratio: 1/1;
            margin-bottom: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        .album-art {
            width: 100%; height: 100%;
            border-radius: 12px;
            background-color: #1c1c1e;
            background-size: cover;
            background-position: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: scale(0.9); /* Estado pausado (encolhido) */
        }
        .album-art.playing { transform: scale(1); } /* Estado tocando (grande) */

        /* Textos */
        .info-area { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 25px; }
        .text-group { flex: 1; padding-right: 15px; overflow: hidden; }
        .track-title {
            font-size: 22px; font-weight: 700;
            margin-bottom: 4px;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            line-height: 1.2;
        }
        .track-artist {
            font-size: 18px; color: rgba(255,255,255,0.6);
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            font-weight: 400;
        }
        /* Botão "..." */
        .more-btn {
            width: 28px; height: 28px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 14px; font-weight: bold; color: white;
        }

        /* Barra de Progresso */
        .progress-container { margin-bottom: 30px; }
        .progress-bar-bg {
            width: 100%; height: 4px;
            background: rgba(255,255,255,0.15);
            border-radius: 2px;
            position: relative;
            overflow: hidden;
        }
        .progress-fill {
            width: 0%; height: 100%;
            background: rgba(255,255,255,0.8);
            border-radius: 2px;
        }
        .timestamps {
            display: flex; justify-content: space-between;
            margin-top: 8px;
            font-size: 10px; color: rgba(255,255,255,0.4);
            font-weight: 600;
        }

        /* Controles */
        .controls {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 40px;
            padding: 0 10px;
        }
        .control-btn { background: none; border: none; padding: 0; cursor: pointer; }
        .icon-svg { fill: white; width: 35px; height: 35px; }
        .icon-play { width: 55px; height: 55px; } /* Botão play maior */
        
        /* Volume (Visual) */
        .volume-area {
            display: flex; align-items: center; gap: 10px;
        }
        .vol-icon { width: 12px; height: 12px; fill: rgba(255,255,255,0.5); }
        .vol-bar {
            flex: 1; height: 4px;
            background: rgba(255,255,255,0.15);
            border-radius: 2px;
            position: relative;
        }
        .vol-fill { width: 70%; height: 100%; background: rgba(255,255,255,0.8); border-radius: 2px; }

        /* Botões inferiores */
        .bottom-actions {
            display: flex; justify-content: space-between; margin-top: 30px; padding: 0 20px;
        }
        .bottom-icon { width: 20px; height: 20px; fill: rgba(255,255,255,0.5); }

    </style>
</head>
<body>

    <div class="dynamic-bg" id="dynamicBg"></div>

    <div id="lock-screen" onclick="startApp()">
        <svg class="apple-logo" viewBox="0 0 384 512"><path d="M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 52.3-11.4 69.5-34.3z"/></svg>
        <div class="tap-text">Toque para Iniciar</div>
    </div>

    <div class="grab-handle"></div>

    <div class="player-container">
        
        <div class="album-art-container">
            <div class="album-art" id="albumArt" style="background-image: url('https://music.apple.com/assets/product-assets/artwork-placeholder-music.png');"></div>
        </div>

        <div class="info-area">
            <div class="text-group">
                <div class="track-title" id="trackName">Apple Music</div>
                <div class="track-artist" id="artistName">Aguardando Conexão...</div>
            </div>
            <div class="more-btn">•••</div>
        </div>

        <div class="progress-container">
            <div class="progress-bar-bg">
                <div class="progress-fill" id="progFill"></div>
            </div>
            <div class="timestamps">
                <span id="currTime">0:00</span>
                <span id="endTime">-0:30</span>
            </div>
        </div>

        <div class="controls">
            <svg class="icon-svg" viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
            
            <div onclick="togglePlay()">
                <svg id="playBtnSVG" class="icon-svg icon-play" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            </div>
            
            <svg class="icon-svg" viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
        </div>

        <div class="volume-area">
            <svg class="vol-icon" viewBox="0 0 24 24"><path d="M7 9v6h4l5 5V4l-5 5H7z"/></svg>
            <div class="vol-bar"><div class="vol-fill"></div></div>
            <svg class="vol-icon" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
        </div>

        <div class="bottom-actions">
            <svg class="bottom-icon" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg> <svg class="bottom-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5zm0-5.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"/></svg> <svg class="bottom-icon" viewBox="0 0 24 24"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg> </div>

    </div>

    <audio id="audioPlayer"></audio>

    <script>
        // --- SUA API ---
        const API_URL = "https://appmaz.vip/api/getdata.php?user=bhj"; 

        // Elementos
        const audio = document.getElementById('audioPlayer');
        const albumArt = document.getElementById('albumArt');
        const bg = document.getElementById('dynamicBg');
        const playBtnSVG = document.getElementById('playBtnSVG');
        const progFill = document.getElementById('progFill');
        
        let lastData = "";
        let audioUnlocked = false;

        // Ícones SVG para Play e Pause
        const iconPlay = '<path d="M8 5v14l11-7z"/>'; // Triângulo
        const iconPause = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>'; // Barras

        // Função de Início (Unlock Audio)
        function startApp() {
            document.getElementById('lock-screen').style.opacity = '0';
            setTimeout(() => document.getElementById('lock-screen').style.display = 'none', 500);
            
            // Toca silêncio para liberar o motor de áudio
            audio.play().then(() => {
                audio.pause();
                audioUnlocked = true;
                checkAPI(); // Primeira checagem
            }).catch(e => console.log("Erro no unlock", e));
        }

        // Loop da API
        async function checkAPI() {
            try {
                const response = await fetch(API_URL + "&t=" + Date.now());
                const json = await response.json();
                const rawText = json.data;

                if (rawText && rawText !== lastData) {
                    lastData = rawText;
                    console.log("Nova música:", rawText);

                    // Separa Musica e Artista
                    let parts = rawText.split("-");
                    let song = parts[0].trim();
                    let artist = parts.length > 1 ? parts[1].trim() : "";

                    // Atualiza UI
                    document.getElementById("trackName").innerText = song;
                    document.getElementById("artistName").innerText = artist;
                    
                    // Busca Mídia
                    fetchMedia(song, artist);
                }
            } catch (error) { console.error(error); }
        }

        async function fetchMedia(song, artist) {
            const query = encodeURIComponent(`${song} ${artist}`);
            try {
                // API iTunes
                const res = await fetch(`https://itunes.apple.com/search?term=${query}&media=music&limit=1`);
                const data = await res.json();

                if (data.results && data.results.length > 0) {
                    const track = data.results[0];
                    
                    // Capa HD (600x600)
                    const hdCover = track.artworkUrl100.replace('100x100', '600x600');
                    albumArt.style.backgroundImage = `url('${hdCover}')`;
                    bg.style.backgroundImage = `url('${hdCover}')`;

                    // Tocar
                    if (track.previewUrl && audioUnlocked) {
                        audio.src = track.previewUrl;
                        audio.play();
                        setPlayState(true);
                    }
                }
            } catch (e) { console.log(e); }
        }

        // Controle de Estado (Play/Pause)
        function setPlayState(isPlaying) {
            if (isPlaying) {
                playBtnSVG.innerHTML = iconPause;
                albumArt.classList.add('playing'); // Efeito de zoom na capa
            } else {
                playBtnSVG.innerHTML = iconPlay;
                albumArt.classList.remove('playing');
            }
        }

        function togglePlay() {
            if (audio.paused) {
                audio.play();
                setPlayState(true);
            } else {
                audio.pause();
                setPlayState(false);
            }
        }

        // Atualização da Barra de Progresso
        audio.ontimeupdate = () => {
            if (audio.duration) {
                const pct = (audio.currentTime / audio.duration) * 100;
                progFill.style.width = pct + "%";
                
                // Tempo Decorrido
                let mins = Math.floor(audio.currentTime / 60);
                let secs = Math.floor(audio.currentTime % 60);
                if (secs < 10) secs = "0" + secs;
                document.getElementById('currTime').innerText = mins + ":" + secs;
                
                // Tempo Restante (contagem regressiva)
                let rem = audio.duration - audio.currentTime;
                let rMins = Math.floor(rem / 60);
                let rSecs = Math.floor(rem % 60);
                if (rSecs < 10) rSecs = "0" + rSecs;
                document.getElementById('endTime').innerText = "-" + rMins + ":" + rSecs;
            }
        };

        audio.onended = () => setPlayState(false);

        // Checar API a cada 2.5s
        setInterval(checkAPI, 2500);

    </script>
</body>
</html>
